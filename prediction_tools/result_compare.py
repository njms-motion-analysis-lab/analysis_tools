from scipy.stats import hypergeom
from tabulate import tabulate
import pprint

RING = {'C1': ['grad_data__cwt_coefficients_34_x',
        'grad_data__fft_coefficient_101_z',
        'grad_data__fft_coefficient_245_z',
        'grad_data__symmetry_looking_2_x',
        'grad_data__fft_coefficient_111_y',
        'grad_data__fft_coefficient_303_z',
        'grad_data__fft_coefficient_109_y',
        'grad_data__fft_coefficient_22_y',
        'grad_data__fft_aggregated_1_y_default',
        'grad_data__energy_ratio_by_chunks_2_y',
        'grad_data__change_quantiles_7_y',
        'grad_data__change_quantiles_6_y',
        'grad_data__agg_linear_trend_27_y',
        'grad_data__agg_linear_trend_15_y_default',
        'grad_data__agg_linear_trend_23_y_default',
        'grad_data__permutation_entropy_0_y',
        'grad_data__partial_autocorrelation_9_y',
        'grad_data__longest_strike_above_mean_0_y',
        'grad_data__fft_coefficient_396_y',
        'grad_data__fourier_entropy_0_y_default',
        'grad_data__cid_ce_1_z',
        'grad_data__approximate_entropy_3_z_default',
        'grad_data__approximate_entropy_4_z',
        'grad_data__friedrich_coefficients_3_y',
        'grad_data__friedrich_coefficients_2_y',
        'grad_data__friedrich_coefficients_1_y_abs',
        'grad_data__cwt_coefficients_55_y',
        'grad_data__cwt_coefficients_54_y',
        'grad_data__cwt_coefficients_6_y',
        'grad_data__change_quantiles_12_y',
        'grad_data__quantile_2_x',
        'grad_data__large_standard_deviation_6_x',
        'grad_data__partial_autocorrelation_2_x',
        'grad_data__agg_linear_trend_22_z',
        'grad_data__agg_linear_trend_14_z',
        'grad_data__fft_coefficient_189_y_abs',
        'grad_data__fft_aggregated_3_x',
        'grad_data__ar_coefficient_1_y',
        'grad_data__fft_aggregated_0_z',
        'grad_data__fft_coefficient_34_z',
        'grad_data__cwt_coefficients_7_z',
        'grad_data__fft_coefficient_189_z',
        'grad_data__cwt_coefficients_42_z',
        'grad_data__change_quantiles_8_z',
        'grad_data__agg_linear_trend_19_z',
        'grad_data__partial_autocorrelation_8_y',
        'grad_data__fft_coefficient_342_x',
        'grad_data__fft_coefficient_189_x',
        'grad_data__cwt_coefficients_22_x',
        'grad_data__fft_coefficient_178_x',
        'grad_data__change_quantiles_6_x',
        'grad_data__change_quantiles_3_x',
        'grad_data__change_quantiles_0_x',
        'grad_data__variation_coefficient_0_z',
        'grad_data__fft_coefficient_367_z',
        'grad_data__fft_coefficient_63_z_default',
        'grad_data__fft_coefficient_58_z_default',
        'grad_data__agg_linear_trend_29_z',
        'grad_data__agg_linear_trend_5_z',
        'grad_data__agg_linear_trend_12_z',
        'grad_data__agg_autocorrelation_1_z_default',
        'grad_data__agg_autocorrelation_0_z',
        'grad_data__fft_coefficient_378_y',
        'grad_data__energy_ratio_by_chunks_2_y_default',
        'grad_data__value_count_2_z',
        'grad_data__ratio_beyond_r_sigma_6_z',
        'grad_data__quantile_0_z',
        'grad_data__minimum_0_z',
        'grad_data__fft_coefficient_212_z',
        'grad_data__lempel_ziv_complexity_3_z',
        'grad_data__partial_autocorrelation_2_x_norm',
        'grad_data__number_cwt_peaks_1_x',
        'grad_data__change_quantiles_45_x',
        'grad_data__change_quantiles_24_x',
        'grad_data__change_quantiles_17_x',
        'grad_data__change_quantiles_16_x',
        'grad_data__change_quantiles_5_x',
        'grad_data__fft_coefficient_315_z',
        'grad_data__ar_coefficient_0_z_abs',
        'grad_data__change_quantiles_9_z',
        'grad_data__cwt_coefficients_10_z',
        'grad_data__change_quantiles_50_z',
        'grad_data__change_quantiles_22_z',
        'grad_data__change_quantiles_21_z',
        'grad_data__agg_linear_trend_3_z',
        'grad_data__fft_coefficient_134_y',
        'grad_data__fft_coefficient_56_y',
        'grad_data__fft_aggregated_1_y_norm',
        'grad_data__partial_autocorrelation_8_x',
        'grad_data__energy_ratio_by_chunks_5_y',
        'grad_data__fft_coefficient_306_x',
        'grad_data__fft_coefficient_289_x',
        'grad_data__fft_coefficient_44_x',
        'grad_data__fft_coefficient_12_x',
        'grad_data__fft_aggregated_1_x',
        'grad_data__energy_ratio_by_chunks_1_x',
        'grad_data__agg_linear_trend_22_x',
        'grad_data__ratio_beyond_r_sigma_2_z_default',
        'grad_data__fft_coefficient_333_z',
        'grad_data__ratio_beyond_r_sigma_1_z_default',
        'grad_data__symmetry_looking_1_x',
        'grad_data__first_location_of_maximum_0_x',
        'grad_data__index_mass_quantile_0_x',
        'grad_data__cwt_coefficients_12_x',
        'grad_data__cwt_coefficients_5_x',
        'grad_data__cwt_coefficients_2_x',
        'grad_data__mean_second_derivative_central_0_y',
        'grad_data__cwt_coefficients_38_y',
        'grad_data__ar_coefficient_0_y',
        'grad_data__agg_linear_trend_23_y_abs',
        'grad_data__agg_linear_trend_15_y_abs',
        'grad_data__variation_coefficient_0_x',
        'grad_data__agg_linear_trend_13_y',
        'grad_data__fft_coefficient_1_z',
        'grad_data__cwt_coefficients_5_z',
        'grad_data__absolute_sum_of_changes_0_z',
        'grad_data__fft_coefficient_323_x',
        'grad_data__fft_coefficient_1_x',
        'grad_data__cwt_coefficients_18_x',
        'grad_data__fft_aggregated_1_x_norm',
        'grad_data__fft_coefficient_289_y',
        'grad_data__fft_coefficient_202_y',
        'grad_data__fft_coefficient_175_y',
        'grad_data__fft_coefficient_172_y',
        'grad_data__fft_coefficient_167_y',
        'grad_data__fft_coefficient_166_y',
        'grad_data__fft_coefficient_162_y',
        'grad_data__fft_coefficient_205_y',
        'grad_data__fft_coefficient_140_z',
        'grad_data__fft_coefficient_144_z',
        'grad_data__change_quantiles_32_x',
        'grad_data__ar_coefficient_7_x',
        'grad_data__change_quantiles_8_x',
        'grad_data__fft_coefficient_145_z_default',
        'grad_data__fft_coefficient_55_z',
        'grad_data__cwt_coefficients_38_z',
        'grad_data__autocorrelation_1_z',
        'grad_data__augmented_dickey_fuller_1_z_default',
        'grad_data__augmented_dickey_fuller_0_z_default',
        'grad_data__ar_coefficient_0_z_default',
        'grad_data__friedrich_coefficients_1_y_default',
        'grad_data__fft_coefficient_307_y',
        'grad_data__friedrich_coefficients_0_y',
        'grad_data__agg_linear_trend_37_x',
        'grad_data__partial_autocorrelation_7_z',
        'grad_data__partial_autocorrelation_4_z',
        'grad_data__number_cwt_peaks_0_z',
        'grad_data__friedrich_coefficients_2_z',
        'grad_data__fft_coefficient_378_z',
        'grad_data__fft_coefficient_363_z',
        'grad_data__fft_coefficient_362_z',
        'grad_data__fft_coefficient_267_z'],
 'C2': ['grad_data__fft_coefficient_278_z',
        'grad_data__agg_linear_trend_17_z',
        'grad_data__agg_linear_trend_16_z',
        'grad_data__symmetry_looking_2_y',
        'grad_data__lempel_ziv_complexity_2_y',
        'grad_data__spkt_welch_density_1_x',
        'grad_data__fft_coefficient_144_x',
        'grad_data__fft_coefficient_2_x',
        'grad_data__change_quantiles_12_x',
        'grad_data__augmented_dickey_fuller_2_x',
        'grad_data__change_quantiles_11_x',
        'grad_data__fft_coefficient_329_y',
        'grad_data__fft_coefficient_339_x',
        'grad_data__fft_coefficient_118_x',
        'grad_data__fft_coefficient_111_x',
        'grad_data__fft_coefficient_108_x',
        'grad_data__augmented_dickey_fuller_0_x',
        'grad_data__agg_linear_trend_4_x',
        'grad_data__symmetry_looking_4_z',
        'grad_data__index_mass_quantile_4_z',
        'grad_data__partial_autocorrelation_8_z',
        'grad_data__index_mass_quantile_2_z',
        'grad_data__fft_coefficient_151_z',
        'grad_data__fft_coefficient_52_z',
        'grad_data__ar_coefficient_2_z',
        'grad_data__permutation_entropy_1_y',
        'grad_data__friedrich_coefficients_1_y',
        'grad_data__fft_coefficient_389_y',
        'grad_data__fft_coefficient_340_y_default',
        'grad_data__fft_coefficient_8_y',
        'grad_data__fft_coefficient_135_y_default',
        'grad_data__fourier_entropy_2_z',
        'grad_data__fft_coefficient_131_z_norm'],
 'C3': ['grad_data__agg_linear_trend_24_z',
        'grad_data__energy_ratio_by_chunks_6_z',
        'grad_data__fft_coefficient_136_z',
        'grad_data__fft_coefficient_137_z',
        'grad_data__fft_aggregated_1_z',
        'grad_data__energy_ratio_by_chunks_9_y',
        'grad_data__range_count_0_z',
        'grad_data__agg_linear_trend_19_z_default',
        'grad_data__friedrich_coefficients_1_z',
        'grad_data__lempel_ziv_complexity_3_x',
        'grad_data__fft_coefficient_12_z',
        'grad_data__fft_coefficient_59_z',
        'grad_data__fft_coefficient_42_z_default',
        'grad_data__agg_linear_trend_30_z',
        'grad_data__ratio_beyond_r_sigma_5_y_default',
        'grad_data__ratio_beyond_r_sigma_4_y',
        'grad_data__fft_coefficient_245_y',
        'grad_data__fft_coefficient_179_y_default',
        'grad_data__fft_coefficient_177_y',
        'grad_data__fft_coefficient_168_y',
        'grad_data__agg_linear_trend_23_y',
        'grad_data__fft_coefficient_3_y',
        'grad_data__fft_coefficient_336_y',
        'grad_data__fft_coefficient_179_y_abs',
        'grad_data__fft_coefficient_169_y',
        'grad_data__fft_coefficient_150_y',
        'grad_data__cwt_coefficients_47_y',
        'grad_data__change_quantiles_54_y',
        'grad_data__cwt_coefficients_7_y',
        'grad_data__fft_coefficient_103_z',
        'grad_data__change_quantiles_55_z',
        'grad_data__change_quantiles_0_z',
        'grad_data__agg_linear_trend_18_z',
        'grad_data__change_quantiles_54_y_norm',
        'grad_data__ratio_beyond_r_sigma_6_y',
        'grad_data__agg_linear_trend_13_z',
        'grad_data__fft_coefficient_112_z',
        'grad_data__fft_coefficient_145_z_abs',
        'grad_data__ar_coefficient_1_x',
        'grad_data__fft_coefficient_135_y_abs',
        'grad_data__change_quantiles_2_x',
        'grad_data__kurtosis_0_z',
        'grad_data__fft_coefficient_220_z',
        'grad_data__first_location_of_maximum_0_z',
        'grad_data__fft_coefficient_348_x',
        'grad_data__fft_coefficient_344_x',
        'grad_data__fft_coefficient_332_x',
        'grad_data__fft_coefficient_328_x',
        'grad_data__agg_linear_trend_7_x',
        'grad_data__ratio_beyond_r_sigma_6_z_default',
        'grad_data__number_peaks_1_z',
        'grad_data__number_peaks_4_z',
        'grad_data__partial_autocorrelation_9_x',
        'grad_data__fft_coefficient_148_z',
        'grad_data__fft_coefficient_154_z',
        'grad_data__ratio_beyond_r_sigma_0_x',
        'grad_data__number_cwt_peaks_0_x',
        'grad_data__fft_coefficient_131_x',
        'grad_data__cwt_coefficients_6_x',
        'grad_data__approximate_entropy_0_x',
        'grad_data__quantile_5_z',
        'grad_data__last_location_of_minimum_0_z_default',
        'grad_data__fft_coefficient_338_z_default',
        'grad_data__fft_coefficient_226_z',
        'grad_data__fft_coefficient_289_z',
        'grad_data__sample_entropy_0_y',
        'grad_data__fft_coefficient_208_x',
        'grad_data__fft_coefficient_323_y',
        'grad_data__fft_coefficient_9_x',
        'grad_data__change_quantiles_7_x',
        'grad_data__fft_coefficient_158_z',
        'grad_data__cwt_coefficients_6_z',
        'grad_data__fft_coefficient_144_y',
        'grad_data__fft_coefficient_141_y',
        'grad_data__fft_coefficient_138_y',
        'grad_data__fft_coefficient_131_y',
        'grad_data__fft_coefficient_165_x',
        'grad_data__agg_linear_trend_17_y',
        'grad_data__autocorrelation_9_x',
        'grad_data__ratio_beyond_r_sigma_0_z',
        'grad_data__longest_strike_above_mean_0_z',
        'grad_data__friedrich_coefficients_0_z',
        'grad_data__fft_coefficient_312_z',
        'grad_data__fft_coefficient_305_z',
        'grad_data__fft_coefficient_237_z',
        'grad_data__fft_coefficient_139_z_default',
        'grad_data__energy_ratio_by_chunks_6_z_default',
        'grad_data__fft_coefficient_123_z',
        'grad_data__longest_strike_below_mean_0_y',
        'grad_data__lempel_ziv_complexity_4_y',
        'grad_data__count_above_mean_0_y',
        'grad_data__fft_coefficient_248_z',
        'grad_data__skewness_0_y',
        'grad_data__partial_autocorrelation_3_y',
        'grad_data__fft_coefficient_378_y_abs',
        'grad_data__fft_coefficient_170_y',
        'grad_data__agg_linear_trend_16_y',
        'grad_data__energy_ratio_by_chunks_8_y',
        'grad_data__energy_ratio_by_chunks_3_z_default',
        'grad_data__energy_ratio_by_chunks_0_z_default',
        'grad_data__autocorrelation_9_z_default',
        'grad_data__ar_coefficient_0_z',
        'grad_data__agg_linear_trend_15_z',
        'grad_data__symmetry_looking_1_y_default',
        'grad_data__fft_coefficient_189_y_default',
        'grad_data__fft_coefficient_29_y_default',
        'grad_data__energy_ratio_by_chunks_9_y_default',
        'grad_data__fft_coefficient_16_y',
        'grad_data__quantile_4_z',
        'grad_data__fft_coefficient_389_z',
        'grad_data__fft_coefficient_50_z_default',
        'grad_data__fft_coefficient_59_z_default',
        'grad_data__change_quantiles_12_z',
        'grad_data__agg_autocorrelation_1_z',
        'grad_data__fft_coefficient_313_y',
        'grad_data__fft_coefficient_5_y',
        'grad_data__energy_ratio_by_chunks_8_y_default',
        'grad_data__fft_coefficient_2_y',
        'grad_data__value_count_2_x',
        'grad_data__permutation_entropy_0_x_norm',
        'grad_data__fft_coefficient_13_x',
        'grad_data__fft_coefficient_142_z',
        'grad_data__fft_coefficient_302_y',
        'grad_data__fft_coefficient_356_x',
        'grad_data__agg_linear_trend_27_x',
        'grad_data__ratio_beyond_r_sigma_4_z',
        'grad_data__agg_linear_trend_26_x',
        'grad_data__large_standard_deviation_5_z',
        'grad_data__friedrich_coefficients_1_z_norm',
        'grad_data__fft_coefficient_3_z',
        'grad_data__cwt_coefficients_4_z',
        'grad_data__cwt_coefficients_2_z',
        'grad_data__change_quantiles_31_z',
        'grad_data__change_quantiles_30_z',
        'grad_data__agg_linear_trend_0_z_norm',
        'grad_data__lempel_ziv_complexity_3_y',
        'grad_data__range_count_2_y',
        'grad_data__fft_coefficient_104_z',
        'grad_data__fft_coefficient_52_z_default',
        'grad_data__cwt_coefficients_43_z',
        'grad_data__cwt_coefficients_24_z',
        'grad_data__fft_coefficient_378_y_default',
        'grad_data__fft_coefficient_14_y',
        'grad_data__fft_coefficient_314_y',
        'grad_data__fft_coefficient_130_z',
        'grad_data__fft_coefficient_132_z',
        'grad_data__fft_coefficient_131_z',
        'grad_data__permutation_entropy_0_x',
        'grad_data__number_peaks_0_x',
        'grad_data__fft_coefficient_110_x',
        'grad_data__skewness_0_z',
        'grad_data__partial_autocorrelation_7_y',
        'grad_data__energy_ratio_by_chunks_5_z_default',
        'grad_data__approximate_entropy_2_z_default',
        'grad_data__cwt_coefficients_3_x',
        'grad_data__fft_coefficient_343_x',
        'grad_data__fft_coefficient_89_y_default',
        'grad_data__agg_linear_trend_35_z',
        'grad_data__energy_ratio_by_chunks_5_y_default',
        'grad_data__sample_entropy_0_z_default',
        'grad_data__partial_autocorrelation_9_z',
        'grad_data__fft_coefficient_223_z',
        'grad_data__fft_coefficient_208_y',
        'grad_data__fft_coefficient_356_y',
        'grad_data__fft_coefficient_112_y',
        'grad_data__first_location_of_minimum_0_z',
        'grad_data__fft_coefficient_146_z',
        'grad_data__fft_coefficient_334_z',
        'grad_data__count_above_0_z',
        'grad_data__change_quantiles_2_z',
        'grad_data__change_quantiles_4_x',
        'grad_data__benford_correlation_0_x',
        'grad_data__change_quantiles_1_x',
        'grad_data__fft_coefficient_301_z',
        'grad_data__fft_coefficient_167_z',
        'grad_data__augmented_dickey_fuller_1_y',
        'grad_data__ar_coefficient_2_z_default',
        'grad_data__energy_ratio_by_chunks_4_z_default',
        'grad_data__large_standard_deviation_5_x',
        'grad_data__fft_coefficient_323_z',
        'grad_data__augmented_dickey_fuller_1_x',
        'grad_data__index_mass_quantile_0_z_default',
        'grad_data__fft_aggregated_1_y',
        'grad_data__mean_0_z',
        'grad_data__fft_coefficient_228_z',
        'grad_data__c3_0_z'],
 'C0': ['grad_data__agg_linear_trend_0_z',
        'grad_data__fft_aggregated_1_z_default']}

BLOCK = {'C1': ['grad_data__fft_coefficient_210_z_abs',
        'grad_data__change_quantiles_2_x',
        'grad_data__change_quantiles_3_z',
        'grad_data__cwt_coefficients_39_z',
        'grad_data__ar_coefficient_3_y',
        'grad_data__energy_ratio_by_chunks_4_y_default',
        'grad_data__fft_coefficient_128_z',
        'grad_data__agg_linear_trend_46_z',
        'grad_data__partial_autocorrelation_5_y',
        'grad_data__partial_autocorrelation_4_y',
        'grad_data__fft_coefficient_241_y',
        'grad_data__cwt_coefficients_28_y_norm',
        'grad_data__change_quantiles_38_y',
        'grad_data__ar_coefficient_5_y',
        'grad_data__fft_coefficient_311_z',
        'grad_data__fft_coefficient_154_z',
        'grad_data__fft_coefficient_302_z',
        'grad_data__change_quantiles_54_z_norm',
        'grad_data__fft_aggregated_1_z',
        'grad_data__change_quantiles_19_z',
        'grad_data__change_quantiles_16_z',
        'grad_data__fft_coefficient_101_y_norm',
        'grad_data__cwt_coefficients_32_y',
        'grad_data__augmented_dickey_fuller_1_y',
        'grad_data__fft_coefficient_120_x',
        'grad_data__fft_coefficient_109_x',
        'grad_data__change_quantiles_34_x',
        'grad_data__agg_linear_trend_27_x',
        'grad_data__change_quantiles_20_x',
        'grad_data__fft_coefficient_356_z_abs',
        'grad_data__fft_coefficient_311_z_abs',
        'grad_data__fft_coefficient_305_z_abs',
        'grad_data__fft_coefficient_115_z',
        'grad_data__fft_coefficient_101_y',
        'grad_data__change_quantiles_10_y',
        'grad_data__change_quantiles_3_y',
        'grad_data__agg_linear_trend_12_y',
        'grad_data__kurtosis_0_x',
        'grad_data__ratio_beyond_r_sigma_1_x',
        'grad_data__fft_coefficient_353_x',
        'grad_data__fft_coefficient_320_x',
        'grad_data__fft_coefficient_267_x',
        'grad_data__fft_coefficient_228_x',
        'grad_data__fft_coefficient_20_x',
        'grad_data__agg_linear_trend_14_x',
        'grad_data__partial_autocorrelation_6_z',
        'grad_data__fft_coefficient_389_z',
        'grad_data__fft_coefficient_356_z_default',
        'grad_data__fft_coefficient_367_z',
        'grad_data__energy_ratio_by_chunks_6_y_default',
        'grad_data__cwt_coefficients_6_y',
        'grad_data__agg_linear_trend_15_y',
        'grad_data__large_standard_deviation_6_x',
        'grad_data__fourier_entropy_4_z',
        'grad_data__fft_coefficient_244_z',
        'grad_data__fft_aggregated_2_z',
        'grad_data__energy_ratio_by_chunks_9_z',
        'grad_data__approximate_entropy_0_z',
        'grad_data__change_quantiles_9_z',
        'grad_data__fft_coefficient_311_z_default',
        'grad_data__fft_coefficient_305_z_default',
        'grad_data__fft_coefficient_209_z',
        'grad_data__fft_coefficient_122_z',
        'grad_data__fft_coefficient_28_z_default',
        'grad_data__fft_coefficient_21_z_default',
        'grad_data__fft_coefficient_7_z',
        'grad_data__change_quantiles_47_z',
        'grad_data__fft_coefficient_148_y',
        'grad_data__fft_coefficient_153_y',
        'grad_data__fft_coefficient_234_y',
        'grad_data__fft_coefficient_102_x',
        'grad_data__index_mass_quantile_4_x',
        'grad_data__fft_coefficient_302_y',
        'grad_data__change_quantiles_14_x',
        'grad_data__friedrich_coefficients_3_z',
        'grad_data__fft_coefficient_363_z_default',
        'grad_data__fft_coefficient_142_z',
        'grad_data__energy_ratio_by_chunks_5_z_default',
        'grad_data__fft_coefficient_59_z_default',
        'grad_data__symmetry_looking_4_y',
        'grad_data__ratio_beyond_r_sigma_6_y',
        'grad_data__longest_strike_below_mean_0_y',
        'grad_data__fft_coefficient_236_y',
        'grad_data__fft_coefficient_139_y_norm',
        'grad_data__ar_coefficient_4_y',
        'grad_data__cwt_coefficients_47_y',
        'grad_data__agg_linear_trend_15_y_default',
        'grad_data__cwt_coefficients_9_y',
        'grad_data__agg_linear_trend_40_y',
        'grad_data__agg_linear_trend_24_x',
        'grad_data__fft_coefficient_317_z',
        'grad_data__fft_coefficient_108_z',
        'grad_data__fft_coefficient_146_y',
        'grad_data__fft_coefficient_141_y',
        'grad_data__fft_coefficient_139_y',
        'grad_data__fft_coefficient_136_y',
        'grad_data__fft_coefficient_111_y',
        'grad_data__linear_trend_3_z',
        'grad_data__fft_coefficient_110_y',
        'grad_data__lempel_ziv_complexity_2_x',
        'grad_data__fft_coefficient_323_x',
        'grad_data__fft_coefficient_138_x',
        'grad_data__fft_coefficient_136_x',
        'grad_data__cwt_coefficients_10_x',
        'grad_data__fft_coefficient_129_x',
        'grad_data__fft_coefficient_212_y_default',
        'grad_data__cwt_coefficients_20_y',
        'grad_data__cwt_coefficients_22_y',
        'grad_data__fft_coefficient_166_y_default',
        'grad_data__fft_coefficient_66_y_default',
        'grad_data__energy_ratio_by_chunks_6_y',
        'grad_data__fft_coefficient_43_y_default',
        'grad_data__change_quantiles_5_z',
        'grad_data__fft_coefficient_367_y'],
 'C2': ['grad_data__ratio_beyond_r_sigma_6_y_default',
        'grad_data__change_quantiles_12_z',
        'grad_data__energy_ratio_by_chunks_4_z_default',
        'grad_data__energy_ratio_by_chunks_8_x',
        'grad_data__fft_coefficient_148_z',
        'grad_data__cwt_coefficients_0_z',
        'grad_data__agg_linear_trend_14_y',
        'grad_data__energy_ratio_by_chunks_3_y_default',
        'grad_data__fft_coefficient_212_y',
        'grad_data__agg_linear_trend_4_y',
        'grad_data__change_quantiles_13_x',
        'grad_data__first_location_of_minimum_0_z',
        'grad_data__fft_coefficient_223_y',
        'grad_data__fft_coefficient_104_z',
        'grad_data__cwt_coefficients_0_y',
        'grad_data__skewness_0_y',
        'grad_data__energy_ratio_by_chunks_7_y_default',
        'grad_data__fft_coefficient_154_y',
        'grad_data__fft_coefficient_128_y',
        'grad_data__change_quantiles_12_y',
        'grad_data__ar_coefficient_0_y',
        'grad_data__ratio_beyond_r_sigma_6_x',
        'grad_data__fft_coefficient_119_x',
        'grad_data__fft_coefficient_116_x',
        'grad_data__fft_coefficient_115_x',
        'grad_data__autocorrelation_9_x',
        'grad_data__fft_coefficient_106_x',
        'grad_data__friedrich_coefficients_0_y',
        'grad_data__fft_coefficient_118_z',
        'grad_data__change_quantiles_10_z',
        'grad_data__agg_autocorrelation_0_z',
        'grad_data__agg_linear_trend_19_z',
        'grad_data__longest_strike_below_mean_0_z',
        'grad_data__cwt_coefficients_5_y',
        'grad_data__median_0_y',
        'grad_data__fft_coefficient_308_z',
        'grad_data__agg_linear_trend_23_y_default',
        'grad_data__agg_linear_trend_37_z',
        'grad_data__change_quantiles_8_z',
        'grad_data__cwt_coefficients_1_y',
        'grad_data__friedrich_coefficients_3_y',
        'grad_data__agg_linear_trend_27_z',
        'grad_data__fourier_entropy_3_y',
        'grad_data__fourier_entropy_0_x',
        'grad_data__cwt_coefficients_56_y',
        'grad_data__agg_linear_trend_16_x',
        'grad_data__change_quantiles_0_y',
        'grad_data__energy_ratio_by_chunks_1_z_default',
        'grad_data__fft_coefficient_234_z',
        'grad_data__fft_coefficient_125_z',
        'grad_data__fft_coefficient_352_z',
        'grad_data__agg_linear_trend_7_y'],
 'C3': ['grad_data__change_quantiles_13_z',
        'grad_data__fft_coefficient_118_x',
        'grad_data__fft_coefficient_301_z',
        'grad_data__agg_linear_trend_28_x',
        'grad_data__fft_coefficient_121_x',
        'grad_data__change_quantiles_1_y',
        'grad_data__change_quantiles_2_y',
        'grad_data__agg_linear_trend_31_y',
        'grad_data__agg_linear_trend_16_z',
        'grad_data__symmetry_looking_3_y',
        'grad_data__fft_coefficient_312_y',
        'grad_data__fourier_entropy_0_y',
        'grad_data__linear_trend_2_z',
        'grad_data__partial_autocorrelation_9_y',
        'grad_data__fft_coefficient_107_z',
        'grad_data__change_quantiles_14_y',
        'grad_data__fft_coefficient_101_x',
        'grad_data__fft_coefficient_167_z',
        'grad_data__partial_autocorrelation_2_y',
        'grad_data__autocorrelation_5_z',
        'grad_data__fft_coefficient_146_z',
        'grad_data__cwt_coefficients_34_z',
        'grad_data__fft_coefficient_223_z',
        'grad_data__time_reversal_asymmetry_statistic_1_z',
        'grad_data__fft_coefficient_117_z_default',
        'grad_data__fft_coefficient_113_z',
        'grad_data__energy_ratio_by_chunks_2_z_default',
        'grad_data__cwt_coefficients_31_z',
        'grad_data__change_quantiles_11_z',
        'grad_data__agg_linear_trend_41_z',
        'grad_data__ar_coefficient_0_z',
        'grad_data__fft_coefficient_142_x',
        'grad_data__fft_coefficient_141_x',
        'grad_data__change_quantiles_10_x',
        'grad_data__agg_autocorrelation_0_x',
        'grad_data__symmetry_looking_3_z_default',
        'grad_data__partial_autocorrelation_9_z_default',
        'grad_data__mean_second_derivative_central_0_z',
        'grad_data__linear_trend_1_z_default',
        'grad_data__friedrich_coefficients_0_z',
        'grad_data__index_mass_quantile_3_z',
        'grad_data__variation_coefficient_0_x',
        'grad_data__time_reversal_asymmetry_statistic_1_x',
        'grad_data__time_reversal_asymmetry_statistic_0_x',
        'grad_data__number_crossing_m_2_x',
        'grad_data__fft_coefficient_329_x',
        'grad_data__linear_trend_3_x',
        'grad_data__agg_linear_trend_13_z',
        'grad_data__fft_coefficient_212_y_abs',
        'grad_data__linear_trend_2_y',
        'grad_data__change_quantiles_5_y',
        'grad_data__agg_linear_trend_5_y',
        'grad_data__agg_linear_trend_6_y',
        'grad_data__fft_coefficient_107_y',
        'grad_data__fft_coefficient_142_y',
        'grad_data__symmetry_looking_3_y_default',
        'grad_data__ratio_beyond_r_sigma_5_y_default',
        'grad_data__number_peaks_4_y_default',
        'grad_data__fft_coefficient_345_y',
        'grad_data__fft_coefficient_329_y',
        'grad_data__fft_coefficient_301_y',
        'grad_data__fft_coefficient_278_y',
        'grad_data__fft_coefficient_202_y',
        'grad_data__fft_coefficient_151_y',
        'grad_data__fft_coefficient_160_y_default',
        'grad_data__fft_coefficient_322_y',
        'grad_data__fft_coefficient_189_y',
        'grad_data__fft_coefficient_140_y',
        'grad_data__fft_coefficient_117_y',
        'grad_data__energy_ratio_by_chunks_4_y',
        'grad_data__fft_coefficient_115_y',
        'grad_data__agg_linear_trend_23_y',
        'grad_data__agg_linear_trend_20_y',
        'grad_data__agg_linear_trend_18_y',
        'grad_data__variance_larger_than_standard_deviation_0_x',
        'grad_data__partial_autocorrelation_7_x',
        'grad_data__fft_coefficient_343_x',
        'grad_data__fft_coefficient_315_x',
        'grad_data__ar_coefficient_10_x',
        'grad_data__fft_coefficient_125_x',
        'grad_data__fft_coefficient_149_z',
        'grad_data__fft_coefficient_153_z',
        'grad_data__fft_coefficient_238_z',
        'grad_data__fft_coefficient_348_z',
        'grad_data__fft_coefficient_124_z',
        'grad_data__symmetry_looking_2_y_default',
        'grad_data__change_quantiles_0_z',
        'grad_data__lempel_ziv_complexity_0_y',
        'grad_data__agg_linear_trend_15_z_norm',
        'grad_data__friedrich_coefficients_0_z_norm',
        'grad_data__fft_coefficient_201_z_norm',
        'grad_data__fft_aggregated_0_z',
        'grad_data__cwt_coefficients_51_z',
        'grad_data__agg_linear_trend_40_z',
        'grad_data__cwt_coefficients_47_z',
        'grad_data__quantile_3_y',
        'grad_data__energy_ratio_by_chunks_8_y_default',
        'grad_data__fft_coefficient_245_y',
        'grad_data__fft_coefficient_201_z',
        'grad_data__fft_coefficient_114_z_abs',
        'grad_data__fft_coefficient_117_z_abs',
        'grad_data__symmetry_looking_4_x',
        'grad_data__number_cwt_peaks_0_x',
        'grad_data__change_quantiles_32_x',
        'grad_data__change_quantiles_5_x',
        'grad_data__autocorrelation_1_x',
        'grad_data__agg_linear_trend_12_x',
        'grad_data__ar_coefficient_1_x',
        'grad_data__energy_ratio_by_chunks_5_y',
        'grad_data__change_quantiles_19_y',
        'grad_data__change_quantiles_17_y',
        'grad_data__binned_entropy_0_y',
        'grad_data__change_quantiles_4_y',
        'grad_data__fft_coefficient_245_z',
        'grad_data__agg_linear_trend_15_z',
        'grad_data__agg_linear_trend_17_z',
        'grad_data__change_quantiles_8_y',
        'grad_data__agg_linear_trend_29_y',
        'grad_data__fft_coefficient_143_y',
        'grad_data__fft_coefficient_144_y',
        'grad_data__agg_linear_trend_17_y',
        'grad_data__fft_coefficient_122_x',
        'grad_data__linear_trend_2_x',
        'grad_data__fft_coefficient_151_z',
        'grad_data__fft_coefficient_120_z',
        'grad_data__cid_ce_1_z_default',
        'grad_data__binned_entropy_0_z_default',
        'grad_data__variation_coefficient_0_y',
        'grad_data__symmetry_looking_4_y_default',
        'grad_data__fft_coefficient_134_y',
        'grad_data__cwt_coefficients_35_y',
        'grad_data__change_quantiles_13_y',
        'grad_data__cwt_coefficients_13_y',
        'grad_data__symmetry_looking_2_z_default',
        'grad_data__last_location_of_maximum_0_z',
        'grad_data__kurtosis_0_z_default',
        'grad_data__fft_coefficient_248_z',
        'grad_data__fft_coefficient_158_z',
        'grad_data__fft_coefficient_161_z',
        'grad_data__lempel_ziv_complexity_3_z',
        'grad_data__fft_coefficient_167_z_norm',
        'grad_data__fft_coefficient_156_z',
        'grad_data__fft_coefficient_145_z',
        'grad_data__fft_coefficient_123_z',
        'grad_data__agg_linear_trend_18_z',
        'grad_data__large_standard_deviation_4_y',
        'grad_data__cwt_coefficients_30_y',
        'grad_data__fft_coefficient_146_x',
        'grad_data__fourier_entropy_3_x',
        'grad_data__symmetry_looking_2_z',
        'grad_data__partial_autocorrelation_3_z',
        'grad_data__max_langevin_fixed_point_0_z',
        'grad_data__number_cwt_peaks_1_z',
        'grad_data__fft_coefficient_106_z',
        'grad_data__cwt_coefficients_14_x',
        'grad_data__fft_coefficient_178_z',
        'grad_data__agg_linear_trend_17_x',
        'grad_data__ratio_beyond_r_sigma_5_z',
        'grad_data__variance_larger_than_standard_deviation_0_z',
        'grad_data__fft_coefficient_116_z',
        'grad_data__change_quantiles_9_y',
        'grad_data__fourier_entropy_0_z',
        'grad_data__fft_coefficient_243_z',
        'grad_data__fft_coefficient_240_z',
        'grad_data__fft_coefficient_56_z',
        'grad_data__cwt_coefficients_38_z',
        'grad_data__cwt_coefficients_5_z',
        'grad_data__change_quantiles_21_x',
        'grad_data__agg_linear_trend_42_z',
        'grad_data__agg_linear_trend_4_x',
        'grad_data__fft_coefficient_304_z',
        'grad_data__change_quantiles_53_z',
        'grad_data__change_quantiles_44_z',
        'grad_data__fft_coefficient_166_y',
        'grad_data__fft_coefficient_162_y',
        'grad_data__fft_coefficient_114_y',
        'grad_data__agg_linear_trend_30_y',
        'grad_data__fft_coefficient_128_x',
        'grad_data__ratio_beyond_r_sigma_2_x',
        'grad_data__energy_ratio_by_chunks_7_x',
        'grad_data__fft_coefficient_354_z',
        'grad_data__fft_coefficient_334_z',
        'grad_data__fft_coefficient_323_z',
        'grad_data__fft_coefficient_202_z_default',
        'grad_data__fft_coefficient_150_z',
        'grad_data__fft_coefficient_121_z',
        'grad_data__fft_coefficient_114_z',
        'grad_data__fft_coefficient_110_z',
        'grad_data__fft_coefficient_111_z',
        'grad_data__cwt_coefficients_54_z',
        'grad_data__cwt_coefficients_24_z',
        'grad_data__change_quantiles_54_z',
        'grad_data__fft_coefficient_165_y',
        'grad_data__fft_coefficient_159_y',
        'grad_data__agg_linear_trend_43_x',
        'grad_data__quantile_3_z',
        'grad_data__median_0_z',
        'grad_data__fft_coefficient_312_z',
        'grad_data__fft_coefficient_389_z_default',
        'grad_data__fft_coefficient_34_z_default',
        'grad_data__energy_ratio_by_chunks_0_z_default',
        'grad_data__partial_autocorrelation_5_y_default',
        'grad_data__fft_coefficient_364_y',
        'grad_data__fft_coefficient_203_z',
        'grad_data__cwt_coefficients_53_z',
        'grad_data__benford_correlation_0_y',
        'grad_data__fft_coefficient_301_x',
        'grad_data__absolute_maximum_0_x',
        'grad_data__fft_coefficient_23_x',
        'grad_data__fft_coefficient_204_z',
        'grad_data__fft_coefficient_133_z',
        'grad_data__fft_coefficient_2_z_default',
        'grad_data__change_quantiles_30_z',
        'grad_data__c3_0_z',
        'grad_data__approximate_entropy_3_z_default',
        'grad_data__index_mass_quantile_2_y_default',
        'grad_data__energy_ratio_by_chunks_2_y_default',
        'grad_data__cwt_coefficients_24_y',
        'grad_data__agg_linear_trend_13_y',
        'grad_data__approximate_entropy_2_y_default',
        'grad_data__partial_autocorrelation_3_y',
        'grad_data__cwt_coefficients_34_y',
        'grad_data__cwt_coefficients_24_y_norm',
        'grad_data__fft_coefficient_242_x',
        'grad_data__fft_coefficient_112_x',
        'grad_data__ratio_beyond_r_sigma_2_z',
        'grad_data__fft_coefficient_189_z',
        'grad_data__fft_coefficient_238_y',
        'grad_data__fft_coefficient_59_y',
        'grad_data__fft_coefficient_135_y',
        'grad_data__standard_deviation_0_z',
        'grad_data__minimum_0_z',
        'grad_data__lempel_ziv_complexity_0_z'],
 'C0': ['grad_data__change_quantiles_23_z', 'grad_data__binned_entropy_0_z']}

total_possible_features = 2300


# i.e: 
 # SigCheck().compare_obj()

class SigCheck():
    def calculate_significance(self, overlap, cluster1_size, cluster2_size, total_features, total_possible_features):
        p_value = hypergeom.sf(overlap - 1, total_possible_features, cluster1_size, cluster2_size)
        return p_value

    def display_overlap_grid(self, ring_clusters, block_clusters, total_possible_features):
        # Get unique features from both tasks
        ring_features = set(feature for cluster in ring_clusters.values() for feature in cluster)
        block_features = set(feature for cluster in block_clusters.values() for feature in cluster)
        total_features = len(ring_features.union(block_features))

        # Create the grid
        grid = []
        headers = [""] + [f"Block Cluster {i} ({len(block_clusters[cluster])})" for i, cluster in enumerate(block_clusters)]

        for ring_cluster, ring_features in ring_clusters.items():
            row = [f"Ring Cluster {ring_cluster[-1]} ({len(ring_features)})"]
            for block_cluster, block_features in block_clusters.items():
                overlap = len(set(ring_features) & set(block_features))
                significance = self.calculate_significance(overlap, len(ring_features), len(block_features), total_features, total_possible_features)
                cell_value = f"{overlap} ({significance:.4e})"
                row.append(cell_value)
            grid.append(row)

        # Color-code the grid based on significance levels
        colored_grid = []
        for row in grid:
            colored_row = []
            for cell in row:
                if isinstance(cell, str) and "(" in cell:
                    significance = float(cell.split("(")[1].split(")")[0])
                    if significance < 0.001:
                        colored_cell = f"\033[1;32m{cell}\033[0m"  # Green (highly significant)
                    elif significance < 0.05:
                        colored_cell = f"\033[1;34m{cell}\033[0m"  # Blue (significant)
                    else:
                        colored_cell = cell
                else:
                    colored_cell = cell
                colored_row.append(colored_cell)
            colored_grid.append(colored_row)

        # Display the grid
        print(tabulate(colored_grid, headers, tablefmt="grid"))

    # Call the function with your data structures


    # We can use the code above instead of setting up the db to start!
    # SigCheck().compare_obj()
    def compare_obj(self, obj1=None, obj2=None, num_features=2300):
        if obj1 != None:
            axis_1 = obj1.get_new_axis(abs_val=False, non_norm=False)
        else:
            axis_1 = RING

        if obj2 != None:
            axis_2 = obj2.get_new_axis(abs_val=False, non_norm=False)
        else:
            axis_2 = BLOCK
            
        pprint.pp("RING")
        pprint.pp(axis_1)
        pprint.pp("BLOCK")
        pprint.pp(axis_2)
        return self.display_overlap_grid(axis_1, axis_2, total_possible_features)
